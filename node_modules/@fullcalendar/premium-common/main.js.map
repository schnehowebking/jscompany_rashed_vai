{"version":3,"file":"main.js","sources":["src/license.tsx","src/options.ts","src/main.ts"],"sourcesContent":["import { config, isValidDate, addDays, createElement, CalendarContext, Fragment } from '@fullcalendar/common'\n\nconst RELEASE_DATE = '<%= releaseDate %>' // for Scheduler\nconst UPGRADE_WINDOW = 365 + 7 // days. 1 week leeway, for tz shift reasons too\nconst INVALID_LICENSE_URL = 'http://fullcalendar.io/docs/schedulerLicenseKey#invalid'\nconst OUTDATED_LICENSE_URL = 'http://fullcalendar.io/docs/schedulerLicenseKey#outdated'\nconst PRESET_LICENSE_KEYS = [\n  'GPL-My-Project-Is-Open-Source',\n  'CC-Attribution-NonCommercial-NoDerivatives',\n]\nconst CSS = {\n  position: 'absolute' as 'absolute', // for TS+React. ugh.\n  zIndex: 99999,\n  bottom: '1px',\n  left: '1px',\n  background: '#eee',\n  borderColor: '#ddd',\n  borderStyle: 'solid',\n  borderWidth: '1px 1px 0 0',\n  padding: '2px 4px',\n  fontSize: '12px',\n  borderTopRightRadius: '3px',\n}\n\nexport function buildLicenseWarning(context: CalendarContext) {\n  let key = context.options.schedulerLicenseKey\n  let currentUrl = typeof window !== 'undefined' ? window.location.href : ''\n\n  if (!isImmuneUrl(currentUrl)) {\n    let status = processLicenseKey(key)\n\n    if (status !== 'valid') {\n      return (\n        <div className=\"fc-license-message\" style={CSS}>\n          {(status === 'outdated') ? (\n            <Fragment>\n              {'Your license key is too old to work with this version. '}\n              <a href={OUTDATED_LICENSE_URL}>More Info</a>\n            </Fragment>\n          ) : (\n            <Fragment>\n              {'Your license key is invalid. '}\n              <a href={INVALID_LICENSE_URL}>More Info</a>\n            </Fragment>\n          )}\n        </div>\n      )\n    }\n  }\n\n  return null\n}\n\n/*\nThis decryption is not meant to be bulletproof. Just a way to remind about an upgrade.\n*/\nfunction processLicenseKey(key) {\n  if (PRESET_LICENSE_KEYS.indexOf(key) !== -1) {\n    return 'valid'\n  }\n\n  const parts = (key || '').match(/^(\\d+)-fcs-(\\d+)$/)\n\n  if (parts && (parts[1].length === 10)) {\n    const purchaseDate = new Date(parseInt(parts[2], 10) * 1000)\n    const releaseDate = new Date(config.mockSchedulerReleaseDate || RELEASE_DATE)\n\n    if (isValidDate(releaseDate)) { // token won't be replaced in dev mode\n      const minPurchaseDate = addDays(releaseDate, -UPGRADE_WINDOW)\n\n      if (minPurchaseDate < purchaseDate) {\n        return 'valid'\n      }\n\n      return 'outdated'\n    }\n  }\n\n  return 'invalid'\n}\n\nfunction isImmuneUrl(url) {\n  return /\\w+:\\/\\/fullcalendar\\.io\\/|\\/examples\\/[\\w-]+\\.html$/.test(url)\n}\n","export const OPTION_REFINERS = {\n  schedulerLicenseKey: String,\n}\n","import { createPlugin } from '@fullcalendar/common'\nimport { buildLicenseWarning } from './license'\nimport { OPTION_REFINERS } from './options'\nimport './options-declare'\n\nexport default createPlugin({\n  optionRefiners: OPTION_REFINERS,\n  viewContainerAppends: [buildLicenseWarning],\n})\n"],"names":[],"mappings":";;;;;;;AAEA,IAAM,YAAY,GAAG,YAAoB,CAAA;AACzC,IAAM,cAAc,GAAG,GAAG,GAAG,CAAC,CAAA;AAC9B,IAAM,mBAAmB,GAAG,yDAAyD,CAAA;AACrF,IAAM,oBAAoB,GAAG,0DAA0D,CAAA;AACvF,IAAM,mBAAmB,GAAG;IAC1B,+BAA+B;IAC/B,4CAA4C;CAC7C,CAAA;AACD,IAAM,GAAG,GAAG;IACV,QAAQ,EAAE,UAAwB;IAClC,MAAM,EAAE,KAAK;IACb,MAAM,EAAE,KAAK;IACb,IAAI,EAAE,KAAK;IACX,UAAU,EAAE,MAAM;IAClB,WAAW,EAAE,MAAM;IACnB,WAAW,EAAE,OAAO;IACpB,WAAW,EAAE,aAAa;IAC1B,OAAO,EAAE,SAAS;IAClB,QAAQ,EAAE,MAAM;IAChB,oBAAoB,EAAE,KAAK;CAC5B,CAAA;SAEe,mBAAmB,CAAC,OAAwB;IAC1D,IAAI,GAAG,GAAG,OAAO,CAAC,OAAO,CAAC,mBAAmB,CAAA;IAC7C,IAAI,UAAU,GAAG,OAAO,MAAM,KAAK,WAAW,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,GAAG,EAAE,CAAA;IAE1E,IAAI,CAAC,WAAW,CAAC,UAAU,CAAC,EAAE;QAC5B,IAAI,QAAM,GAAG,iBAAiB,CAAC,GAAG,CAAC,CAAA;QAEnC,IAAI,QAAM,KAAK,OAAO,EAAE;YACtB,QACE,uBAAK,SAAS,EAAC,oBAAoB,EAAC,KAAK,EAAE,GAAG,IAC3C,CAAC,QAAM,KAAK,UAAU,KACrB,cAAC,QAAQ;gBACN,yDAAyD;gBAC1D,qBAAG,IAAI,EAAE,oBAAoB,gBAAe,CACnC,KAEX,cAAC,QAAQ;gBACN,+BAA+B;gBAChC,qBAAG,IAAI,EAAE,mBAAmB,gBAAe,CAClC,CACZ,CACG,EACP;SACF;KACF;IAED,OAAO,IAAI,CAAA;AACb,CAAC;AAED;;;AAGA,SAAS,iBAAiB,CAAC,GAAG;IAC5B,IAAI,mBAAmB,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE;QAC3C,OAAO,OAAO,CAAA;KACf;IAED,IAAM,KAAK,GAAG,CAAC,GAAG,IAAI,EAAE,EAAE,KAAK,CAAC,mBAAmB,CAAC,CAAA;IAEpD,IAAI,KAAK,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,MAAM,KAAK,EAAE,CAAC,EAAE;QACrC,IAAM,YAAY,GAAG,IAAI,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,IAAI,CAAC,CAAA;QAC5D,IAAM,WAAW,GAAG,IAAI,IAAI,CAAC,MAAM,CAAC,wBAAwB,IAAI,YAAY,CAAC,CAAA;QAE7E,IAAI,WAAW,CAAC,WAAW,CAAC,EAAE;YAC5B,IAAM,eAAe,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,CAAA;YAE7D,IAAI,eAAe,GAAG,YAAY,EAAE;gBAClC,OAAO,OAAO,CAAA;aACf;YAED,OAAO,UAAU,CAAA;SAClB;KACF;IAED,OAAO,SAAS,CAAA;AAClB,CAAC;AAED,SAAS,WAAW,CAAC,GAAG;IACtB,OAAO,sDAAsD,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;AACzE;;ACnFO,IAAM,eAAe,GAAG;IAC7B,mBAAmB,EAAE,MAAM;CAC5B;;ACGD,WAAe,YAAY,CAAC;IAC1B,cAAc,EAAE,eAAe;IAC/B,oBAAoB,EAAE,CAAC,mBAAmB,CAAC;CAC5C,CAAC;;;;"}